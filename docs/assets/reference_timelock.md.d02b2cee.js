import{_ as s,o as a,c as n,Q as o}from"./chunks/framework.0c8e00f4.js";const u=JSON.parse('{"title":"Timelock Program","description":"","frontmatter":{},"headers":[],"relativePath":"reference/timelock.md","filePath":"reference/timelock.md"}'),e={name:"reference/timelock.md"},l=o(`<h1 id="timelock-program" tabindex="-1">Timelock Program <a class="header-anchor" href="#timelock-program" aria-label="Permalink to &quot;Timelock Program&quot;">​</a></h1><p>The Timelock program enables simple state-channel mechanics on Solana, as described in detail by <a href="https://vitalik.ca/general/2021/01/05/rollup.html" target="_blank" rel="noreferrer">Vitalik</a> and <a href="https://www.jeffcoleman.ca/state-channels/" target="_blank" rel="noreferrer">Jeff Coleman</a>. It&#39;s specifically designed to be used with the <a href="https://www.getcode.com/download" target="_blank" rel="noreferrer">Code App</a>.</p><p>When combined with durable nonces, the Timelock program provides non-custodial guarantees of funds availability. This feature has practical uses in various areas, including applications that require instant off chain transactions.</p><h3 id="how-it-works" tabindex="-1">How it works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How it works&quot;">​</a></h3><p>We&#39;ve created the Timelock program to enable instant and reliable transfers on Solana. It&#39;s specifically designed to be used with the Code app. However, it has practical uses in various areas beyond ours, including applications that require instant off chain transactions.</p><p>Features of the Timelock program include:</p><ul><li><strong>Fund Locking</strong>: This is a testament to a user&#39;s readiness to transact. By locking their funds, they vouch for their availability and commitment.</li><li><strong>State Transition</strong>: This pertains to the changing status of locked funds. A joint signature, from both the user and the Code Sequencer, is mandated.</li><li><strong>User-Initiated Unlocks</strong>: Users maintain control over their funds, with the capability to kick-start the unlocking process on their terms.</li><li><strong>Fallback Mechanisms</strong>: As a safeguard, if users face issues with the Code Sequencer, they have a built-in 21-day waiting period after which they can access their funds.</li></ul><p>Developers that want to learn more can visit the <a href="https://github.com/code-payments/code-program-library/tree/main/timelock" target="_blank" rel="noreferrer">GitHub repository</a> for the Timelock program.</p><img src="https://github.com/code-payments/code-program-library/blob/main/timelock/docs/timelock-token.png?raw=true"><h2 id="on-chain-program" tabindex="-1">On-chain Program <a class="header-anchor" href="#on-chain-program" aria-label="Permalink to &quot;On-chain Program&quot;">​</a></h2><p>The Timelock program is deployed to Solana mainnet-beta at the following address:</p><p><a href="https://explorer.solana.com/address/time2Z2SCnn3qYg3ULKVtdkh8YmZ5jFdKicnA1W2YnJ" target="_blank" rel="noreferrer">time2Z2SCnn3qYg3ULKVtdkh8YmZ5jFdKicnA1W2YnJ</a></p><p>The source code is available on <a href="https://github.com/code-payments/code-program-library/tree/main/timelock" target="_blank" rel="noreferrer">GitHub</a>.</p><h2 id="account-derivation" tabindex="-1">Account Derivation <a class="header-anchor" href="#account-derivation" aria-label="Permalink to &quot;Account Derivation&quot;">​</a></h2><p>Each Code user has a primary account, which is derived from a BIP-32 mnemonic. The Timelock program uses this account to create multiple associated Timelock accounts for the user.</p><p>The Timelock account is derived from the primary account using the following <a href="https://github.com/code-payments/timelock-explorer/blob/77a01f685dbaa4f77c2c1ec1e59b4ce568c8a388/src/types/explorer/CodeWallet.ts#L107C1-L129C2" target="_blank" rel="noreferrer">derivation paths</a>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Code Wallet derivation strategy to generate a derivation path</span></span>
<span class="line"><span style="color:#6A737D;"> * for a given account type, index, and offset.</span></span>
<span class="line"><span style="color:#6A737D;"> * </span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E1E4E8;">accountType</span><span style="color:#6A737D;"> The account type</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E1E4E8;">index</span><span style="color:#6A737D;"> The index</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E1E4E8;">offset</span><span style="color:#6A737D;"> The offset</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@returns</span><span style="color:#6A737D;"> </span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDerivationPath</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">accountType</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TrayAccountType</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">index</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">number</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">offset</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">number</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Path</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (accountType) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> TrayAccountType.Primary:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> CodeDefaultPath;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> TrayAccountType.Bucket:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Path</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`m/44&#39;/501&#39;/0&#39;/0&#39;/\${</span><span style="color:#E1E4E8;">index</span><span style="color:#9ECBFF;">}&#39;/\${</span><span style="color:#E1E4E8;">offset</span><span style="color:#9ECBFF;">}&#39;\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> TrayAccountType.Incoming:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Path</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`m/44&#39;/501&#39;/0&#39;/0&#39;/\${</span><span style="color:#E1E4E8;">index</span><span style="color:#9ECBFF;">}&#39;/2&#39;\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> TrayAccountType.Outgoing:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Path</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`m/44&#39;/501&#39;/0&#39;/0&#39;/\${</span><span style="color:#E1E4E8;">index</span><span style="color:#9ECBFF;">}&#39;/3&#39;\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`Unknown account type: \${</span><span style="color:#E1E4E8;">accountType</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Code Wallet derivation strategy to generate a derivation path</span></span>
<span class="line"><span style="color:#6A737D;"> * for a given account type, index, and offset.</span></span>
<span class="line"><span style="color:#6A737D;"> * </span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#24292E;">accountType</span><span style="color:#6A737D;"> The account type</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#24292E;">index</span><span style="color:#6A737D;"> The index</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#24292E;">offset</span><span style="color:#6A737D;"> The offset</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@returns</span><span style="color:#6A737D;"> </span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDerivationPath</span><span style="color:#24292E;">(</span><span style="color:#E36209;">accountType</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TrayAccountType</span><span style="color:#24292E;">, </span><span style="color:#E36209;">index</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">number</span><span style="color:#24292E;">, </span><span style="color:#E36209;">offset</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">number</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Path</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (accountType) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> TrayAccountType.Primary:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> CodeDefaultPath;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> TrayAccountType.Bucket:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Path</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`m/44&#39;/501&#39;/0&#39;/0&#39;/\${</span><span style="color:#24292E;">index</span><span style="color:#032F62;">}&#39;/\${</span><span style="color:#24292E;">offset</span><span style="color:#032F62;">}&#39;\`</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> TrayAccountType.Incoming:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Path</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`m/44&#39;/501&#39;/0&#39;/0&#39;/\${</span><span style="color:#24292E;">index</span><span style="color:#032F62;">}&#39;/2&#39;\`</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> TrayAccountType.Outgoing:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Path</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`m/44&#39;/501&#39;/0&#39;/0&#39;/\${</span><span style="color:#24292E;">index</span><span style="color:#032F62;">}&#39;/3&#39;\`</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">default</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`Unknown account type: \${</span><span style="color:#24292E;">accountType</span><span style="color:#032F62;">}\`</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>If you&#39;d like to derive your own Timelock accounts, you can use the <a href="https://www.npmjs.com/package/@code-wallet/mnemonic" target="_blank" rel="noreferrer">mnemonic package</a> to do so. However, that is out of the scope of this documentation.</p><h2 id="security-concerns" tabindex="-1">Security Concerns <a class="header-anchor" href="#security-concerns" aria-label="Permalink to &quot;Security Concerns&quot;">​</a></h2><p>The on-chain programs are open-source and audited. However, if you find something that would improve the efficacy of the program we welcome and encourage patches but ask that you submit any security concerns privately by using this <a href="https://github.com/code-payments/code-program-library/security/advisories/new" target="_blank" rel="noreferrer">Report a Vulnerability</a> link.</p><div class="warning custom-block"><p class="custom-block-title">Disclosures</p><p>Please do not disclose security concerns publicly, or through email or twitter, until they have been addressed by the Code team.</p></div>`,21),p=[l];function t(r,c,i,y,E,h){return a(),n("div",null,p)}const m=s(e,[["render",t]]);export{u as __pageData,m as default};
