import{_ as s,o as n,c as a,Q as e}from"./chunks/framework.0c8e00f4.js";const u=JSON.parse('{"title":"Code Sequencer","description":"","frontmatter":{},"headers":[],"relativePath":"reference/sequencer.md","filePath":"reference/sequencer.md"}'),o={name:"reference/sequencer.md"},l=e(`<h1 id="code-sequencer" tabindex="-1">Code Sequencer <a class="header-anchor" href="#code-sequencer" aria-label="Permalink to &quot;Code Sequencer&quot;">​</a></h1><p>To break into mainstream adoption, payments need to be instant and they need to be guaranteed. If a user has to wait, or they get a failed transaction they will think the experience is broken, and when you&#39;re dealing with money the experience cannot feel broken. That is why we built the Code Sequencer. Solana is fast, but even with an average block time of ~400ms, there are periods of volatility where the block time can creep up over 1 second. We need things to be predictably instant.</p><p>The other challenge is that payments routinely aren’t included in the next block, and without a mempool these payments end up failing on the application side. Again making for a broken experience for consumers.</p><p>The Code Sequencer addresses these challenges gracefully managing the &quot;pending confirmation&quot; periods inherent to all blockchains to deliver an instant experience for the user.</p><p>The Code Sequencer aims to offer speed, reliability, and privacy in transactions. All users know is that payments &quot;just work&quot; every time, but under the hood, the Code Sequencer is seamlessly handling all of the complexity and unpredictability of on chain operations.</p><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">graph</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">LR</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">A</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">Code App</span><span style="color:#F97583;">])</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">C</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">Code Sequencer</span><span style="color:#F97583;">])</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">B</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">Code SDK</span><span style="color:#F97583;">])</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">C</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">C </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">D</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">Solana</span><span style="color:#F97583;">])</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">E</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">Geyser</span><span style="color:#F97583;">])</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">C</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">D </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">E</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">graph</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">LR</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">A</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">Code App</span><span style="color:#D73A49;">])</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">C</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">Code Sequencer</span><span style="color:#D73A49;">])</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">B</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">Code SDK</span><span style="color:#D73A49;">])</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">C</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">C </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">D</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">Solana</span><span style="color:#D73A49;">])</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">E</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">Geyser</span><span style="color:#D73A49;">])</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">C</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">D </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">E</span></span></code></pre></div><h2 id="why-the-code-sequencer" tabindex="-1">Why the Code Sequencer? <a class="header-anchor" href="#why-the-code-sequencer" aria-label="Permalink to &quot;Why the Code Sequencer?&quot;">​</a></h2><p>Traditional blockchain confirmations aren&#39;t ideal for on-the-spot transactions, like grabbing a coffee. The Code Sequencer facilitates instant transfers, ensuring that once a payment commitment is made by a user, it&#39;s final.</p><h3 id="features" tabindex="-1">Features <a class="header-anchor" href="#features" aria-label="Permalink to &quot;Features&quot;">​</a></h3><ul><li><strong>Instant Transactions</strong>: Offers instant fund transfers.</li><li><strong>Reliability</strong>: Utilizes nonced transactions for security and preventing double spends.</li><li><strong>Privacy</strong>: Interacts with the Splitter program to upgrade payment intents, safeguarding user account and payment details.</li></ul><p>The Code Sequencer is <strong>permissionless and self-custodial</strong>. It doesn&#39;t hold a user&#39;s funds or private keys, it only schedules signed transactions. Users are able to use the underlying Solana blockchain directly if necessary. There is an open source tool to do so called the <a href="https://github.com/code-wallet/timelock-explorer/tree/main" target="_blank" rel="noreferrer">Timelock Explorer</a>.</p><div class="warning custom-block"><p class="custom-block-title">Access Keys</p><p>The Code Sequencer never sees or knows the private keys of a user&#39;s accounts or their private key (What Code refers to as an &quot;Access Key&quot;).</p></div><h2 id="how-to-use-the-code-sequencer" tabindex="-1">How to Use the Code Sequencer <a class="header-anchor" href="#how-to-use-the-code-sequencer" aria-label="Permalink to &quot;How to Use the Code Sequencer&quot;">​</a></h2><p>As a Code app or Code SDK user, there is nothing you need to do to use the sequencer. It&#39;s built into the Code app and SDK.</p><p>The Code Sequencer is a Layer 2 (L2) system that works in tandem with the Code app. The Code app is the primary interface for users to send money or make payments, and that experience is powered by the Code Sequencer. The Code Sequencer, in turn, submits payments to the Solana blockchain.</p><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">​</a></h2><p>Put simply, the Code Sequencer maintains a global state and runs a local simulation of submitted <a href="./../intents/introduction.html">Intents</a>. It is the Code Sequencer&#39;s job to ensure that state transitions are valid and that referenced accounts are in locked state. Submitted intents are scheduled and sent to the Solana blockchain asynchronously.</p><p>The internals of the sequencer are quite complex, but the basic flow can roughly broken down into the following:</p><p>When an intent is created on the mobile app, a set of actions are required to fulfill that intent. These actions can be composed into transactions with durable nonce values provided by the Code Sequencer. The transactions are then signed and sent to the Code Sequencer. The Code Sequencer then validates the transactions and schedules them to be submitted to the Solana blockchain.</p><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">graph</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TD</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">a</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">Code App</span><span style="color:#F97583;">])</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">b</span><span style="color:#F97583;">[</span><span style="color:#9ECBFF;">Intent</span><span style="color:#F97583;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">b </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">c</span><span style="color:#F97583;">[</span><span style="color:#9ECBFF;">&quot;Action 1&quot;</span><span style="color:#F97583;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">b </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">d</span><span style="color:#F97583;">[</span><span style="color:#9ECBFF;">&quot;Action 2&quot;</span><span style="color:#F97583;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">c </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">e</span><span style="color:#F97583;">[</span><span style="color:#9ECBFF;">Tx 1</span><span style="color:#F97583;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">c </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">f</span><span style="color:#F97583;">[</span><span style="color:#9ECBFF;">Tx 2</span><span style="color:#F97583;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">d </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">g</span><span style="color:#F97583;">[</span><span style="color:#9ECBFF;">Tx ...</span><span style="color:#F97583;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">d </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">h</span><span style="color:#F97583;">[</span><span style="color:#9ECBFF;">Tx N</span><span style="color:#F97583;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">e </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">j</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">&quot;\`**Code Sequencer**</span></span>
<span class="line"><span style="color:#9ECBFF;">  Scheduled:&amp;nbsp;TxM,&amp;nbsp;TxM+1,&amp;nbsp;TxM+2...</span></span>
<span class="line"><span style="color:#9ECBFF;">  \`&quot;</span><span style="color:#F97583;">])</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">f </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">j</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">g </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">j</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">h </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">j</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FFAB70;">j </span><span style="color:#F97583;">--&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">k</span><span style="color:#F97583;">([</span><span style="color:#9ECBFF;">Solana</span><span style="color:#F97583;">])</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">graph</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TD</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">a</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">Code App</span><span style="color:#D73A49;">])</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">b</span><span style="color:#D73A49;">[</span><span style="color:#032F62;">Intent</span><span style="color:#D73A49;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">b </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">c</span><span style="color:#D73A49;">[</span><span style="color:#032F62;">&quot;Action 1&quot;</span><span style="color:#D73A49;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">b </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">d</span><span style="color:#D73A49;">[</span><span style="color:#032F62;">&quot;Action 2&quot;</span><span style="color:#D73A49;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">c </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">e</span><span style="color:#D73A49;">[</span><span style="color:#032F62;">Tx 1</span><span style="color:#D73A49;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">c </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">f</span><span style="color:#D73A49;">[</span><span style="color:#032F62;">Tx 2</span><span style="color:#D73A49;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">d </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">g</span><span style="color:#D73A49;">[</span><span style="color:#032F62;">Tx ...</span><span style="color:#D73A49;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">d </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">h</span><span style="color:#D73A49;">[</span><span style="color:#032F62;">Tx N</span><span style="color:#D73A49;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">e </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">j</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">&quot;\`**Code Sequencer**</span></span>
<span class="line"><span style="color:#032F62;">  Scheduled:&amp;nbsp;TxM,&amp;nbsp;TxM+1,&amp;nbsp;TxM+2...</span></span>
<span class="line"><span style="color:#032F62;">  \`&quot;</span><span style="color:#D73A49;">])</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">f </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">j</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">g </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">j</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">h </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">j</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#E36209;">j </span><span style="color:#D73A49;">--&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">k</span><span style="color:#D73A49;">([</span><span style="color:#032F62;">Solana</span><span style="color:#D73A49;">])</span></span></code></pre></div><p>For example, when a user sends Digital Paper Cash using the Code App, the result is an <code>Intent</code>. The mobile app will eventually compose the intent into several transactions during the life-cycle of the intent.</p><p>This follows 4 steps:</p><ol><li><strong>Local Simulation</strong>: The mobile app will submit the intent to the Code Sequencer. The Code Sequencer will confirm the state transitions are valid based on the global state. If valid, the Code Sequencer will respond with <a href="https://docs.solana.com/offline-signing/durable-nonce" target="_blank" rel="noreferrer">durable nonce</a> values that should be used to sign transactions as part of the intent.</li><li><strong>Transaction Submission</strong>: Assuming the intent is valid, the Code app will then construct a set of transactions that fulfill the intent and sign them using the provided durable nonces. These transactions get sent as signatures to the Code Sequencer, which then re-constructs the transactions from the original intent. If any of the account values don&#39;t line up, the signatures would not be valid and would get rejected by the Sequencer (and Solana).</li><li><strong>Transaction Scheduling</strong>: If the signatures are valid, the Code Sequencer will update its global state. The transactions are scheduled asynchronously, along with transactions from other users, to be sent to the Solana blockchain.</li><li><strong>Confirmation</strong>: The Code Sequencer will then send a confirmation to the Code app that the intent has been fulfilled.</li></ol><p>This is a highly simplified overview. To learn more, please refer to the <a href="./splitter.html">Code Privacy Protocol</a>.</p>`,24),t=[l];function p(r,c,i,y,d,h){return n(),a("div",null,t)}const F=s(o,[["render",p]]);export{u as __pageData,F as default};
